

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>lingvo.core.base_layer module &mdash; lingvo  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lingvo.core.base_layer_test module" href="lingvo.core.base_layer_test.html" />
    <link rel="prev" title="lingvo.core.base_input_generator module" href="lingvo.core.base_input_generator.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> lingvo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="lingvo.html">lingvo package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lingvo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="lingvo.core.html">lingvo.core package</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="lingvo.core.html#subpackages">Subpackages</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="lingvo.core.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tasks.html">lingvo.tasks package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tools.html">lingvo.tools package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lingvo.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">lingvo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="lingvo.html">lingvo package</a> &raquo;</li>
        
          <li><a href="lingvo.core.html">lingvo.core package</a> &raquo;</li>
        
      <li>lingvo.core.base_layer module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/lingvo.core.base_layer.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-lingvo.core.base_layer">
<span id="lingvo-core-base-layer-module"></span><h1>lingvo.core.base_layer module<a class="headerlink" href="#module-lingvo.core.base_layer" title="Permalink to this headline">¶</a></h1>
<p>Base class for all layers.</p>
<dl class="class">
<dt id="lingvo.core.base_layer.Accumulator">
<em class="property">class </em><code class="descclassname">lingvo.core.base_layer.</code><code class="descname">Accumulator</code><a class="reference internal" href="_modules/lingvo/core/base_layer.html#Accumulator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.Accumulator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Layers can register accumulators to persist step-level state.</p>
<p>Accumulators must be represented by a Tensor of a fixed shape. The default
value must be supplied by overriding DefaultValue(). It is important that
the default tensor value is created on each call in order to avoid
accumulators leaking to different graphs.</p>
<p>Accumulators can be enabled (default) or disabled by pairing
Disable()/Enable() calls. When disabled, the accumulator will only return
the default value and will silently drop calls to SetValue(). When computing
gradients that may touch accumulators, calls should be bracketed with
Disable()/Enable().</p>
<p>Care must be taken when manipulating accumulators across Defun boundaries.
Typically, values for all accumulators in a layer must be explicitly
retrieved and passed in to the Defun scope by calling
layer.GetAccumulatorValues(), marshalling into the Defun and setting them
via layer.SetAccumulatorValues(). The reverse must be done on return.</p>
<dl class="method">
<dt id="lingvo.core.base_layer.Accumulator.DefaultValue">
<code class="descname">DefaultValue</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#Accumulator.DefaultValue"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.Accumulator.DefaultValue" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.Accumulator.Disable">
<code class="descname">Disable</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#Accumulator.Disable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.Accumulator.Disable" title="Permalink to this definition">¶</a></dt>
<dd><p>Disables the accumulator (must be balanced with Enable).</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.Accumulator.Enable">
<code class="descname">Enable</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#Accumulator.Enable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.Accumulator.Enable" title="Permalink to this definition">¶</a></dt>
<dd><p>Enables the accumulator (must balance a Disable).</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.Accumulator.GetValue">
<code class="descname">GetValue</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#Accumulator.GetValue"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.Accumulator.GetValue" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the current value of the accumulator Tensor.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.Accumulator.Reset">
<code class="descname">Reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#Accumulator.Reset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.Accumulator.Reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Resets the accumulator to its default value.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.Accumulator.SetValue">
<code class="descname">SetValue</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#Accumulator.SetValue"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.Accumulator.SetValue" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the current value of the accumulator Tensor.</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.core.base_layer.Accumulator.is_disabled">
<code class="descname">is_disabled</code><a class="headerlink" href="#lingvo.core.base_layer.Accumulator.is_disabled" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether the accumulator is disabled.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="lingvo.core.base_layer.DefaultVN">
<code class="descclassname">lingvo.core.base_layer.</code><code class="descname">DefaultVN</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#DefaultVN"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.DefaultVN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="lingvo.core.base_layer.LayerBase">
<em class="property">class </em><code class="descclassname">lingvo.core.base_layer.</code><code class="descname">LayerBase</code><span class="sig-paren">(</span><em>params</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Base class for all the layer object.</p>
<dl class="method">
<dt id="lingvo.core.base_layer.LayerBase.AddChild">
<code class="descname">AddChild</code><span class="sig-paren">(</span><em>name</em>, <em>child</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase.AddChild"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.AddChild" title="Permalink to this definition">¶</a></dt>
<dd><p>Add an existing layer as a sublayer.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.LayerBase.AddChildren">
<code class="descname">AddChildren</code><span class="sig-paren">(</span><em>name</em>, <em>children</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase.AddChildren"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.AddChildren" title="Permalink to this definition">¶</a></dt>
<dd><p>Add existing layers as sublayers.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.LayerBase.AddExtraTheta">
<code class="descname">AddExtraTheta</code><span class="sig-paren">(</span><em>theta_name</em>, <em>theta_value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase.AddExtraTheta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.AddExtraTheta" title="Permalink to this definition">¶</a></dt>
<dd><p>Add extra theta that doesn’t directly correspond to vars.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.LayerBase.AddFunction">
<code class="descname">AddFunction</code><span class="sig-paren">(</span><em>name</em>, <em>f</em>, <em>replace=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase.AddFunction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.AddFunction" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a function to the layer’s ‘fns’ collection.</p>
<p>This should be used to add op-like functions specific to the operation
of the layer and its children. Such functions should be added in __init__
and may either be raw python functions or TensorFlow Defuns. This
facility is just a mechanism for organizing them and having basic checks
on name collisions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> – The name of the function. It will be accessible as self.fns.{name}.</li>
<li><strong>f</strong> – The function body.</li>
<li><strong>replace</strong> – Whether to replace an existing function (default False).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AttributeError</span></code> – If the function already exists (and replace=False).</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.LayerBase.AddGlobalVN">
<code class="descname">AddGlobalVN</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase.AddGlobalVN"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.AddGlobalVN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="staticmethod">
<dt id="lingvo.core.base_layer.LayerBase.CopyBaseParams">
<em class="property">static </em><code class="descname">CopyBaseParams</code><span class="sig-paren">(</span><em>from_params</em>, <em>to_params</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase.CopyBaseParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.CopyBaseParams" title="Permalink to this definition">¶</a></dt>
<dd><p>Copies LayerBase params from ‘from_params’ to ‘to_params’.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.LayerBase.CreateChild">
<code class="descname">CreateChild</code><span class="sig-paren">(</span><em>name</em>, <em>params</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase.CreateChild"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.CreateChild" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a sub layer.</p>
<p>The created sub layer can be access by ‘name’. E.g.,</p>
<blockquote>
<div>self.CreateChild(‘foo’, …)
self.foo.FProp…</div></blockquote>
<dl class="docutils">
<dt>or</dt>
<dd>self.children[‘foo’].Fprop…
self.children.foo.Fprop…</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> – Sub layer name which is used as the key into vars/theta.</li>
<li><strong>params</strong> – Hyperparams object to instantiate a layer.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.LayerBase.CreateChildren">
<code class="descname">CreateChildren</code><span class="sig-paren">(</span><em>name</em>, <em>params_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase.CreateChildren"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.CreateChildren" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a list of sub layers.</p>
<p>The created sub layer list can be access by ‘name’. E.g.,</p>
<blockquote>
<div>self.CreateChildren(‘foo’, …)
self.foo[10].FProp…</div></blockquote>
<dl class="docutils">
<dt>or</dt>
<dd>self.children[‘foo’][10].Fprop…
self.children.foo[10].Fprop…</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> – The name for the sub layers, which is used as the key
into vars/theta.</li>
<li><strong>params_list</strong> – Hyperparams objects to instantiate a list of layers.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.LayerBase.CreateVariable">
<code class="descname">CreateVariable</code><span class="sig-paren">(</span><em>name</em>, <em>var_params</em>, <em>theta_fn=None</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase.CreateVariable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.CreateVariable" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a variable.</p>
<p>Create a variable of this layer according to the parameter var_params. E.g.,</p>
<blockquote>
<div><dl class="docutils">
<dt>def __init__(self, …):    # A layer’s constructor</dt>
<dd>self.CreateVariable(‘weight’, py_utils.WeightParams(shape=[100, 100]))</dd>
</dl>
</div></blockquote>
<p>theta_fn is used to apply a simple transformation on the created
variable’s value before used by the forward computation. E.g., to
add the global variational noise according to this layer’s
parameter, one can do:</p>
<blockquote>
<div><dl class="docutils">
<dt>def __init__(self, …):    # A layer’s constructor</dt>
<dd><dl class="first last docutils">
<dt>self.CreateVariable(</dt>
<dd>name=’weight’,
var_params=py_utils.WeightParams(shape=[100, 100]),
theta_fn=self.AddGlobalVN)</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> – Variable name which is used as the key into vars/theta.</li>
<li><strong>var_params</strong> – Params used to create the variable.</li>
<li><strong>theta_fn</strong> – A python function takes a variable’s value and returns
a new value to be used later for computation. Its signature must be
(tf.Tensor) -&gt; (tf.Tensor).</li>
<li><strong>*args</strong> – List of args passed to py_utils.CreateVariable.</li>
<li><strong>**kwargs</strong> – Keyword args passed to py_utils.CreateVariable.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.LayerBase.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward propagation.</p>
<p>The central interface that subclasses should implement. The caller
calls FProp with a theta dictionary. E.g.,</p>
<blockquote>
<div>foo = InstanceOfASubClassOfFoo(params)
y = foo.FProp(foo.theta, x)</div></blockquote>
<p>The implementation of FProp() computes a function given
the theta and the inputs. E.g.,</p>
<blockquote>
<div>subs = self.children
inputs = args[0]
a0 = subs.linear.FProp(theta.linear, inputs)
a1 = subs.softmax.FProp(theta.softmax, a0)
# The same layer applied twice.
a2 = subs.linear.FProp(theta.linear, a1)
return a2</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>theta</strong> – A nested map object containing weights’ values of this
layer and its children layers.</li>
<li><strong>*args</strong> – List args.</li>
<li><strong>**kwargs</strong> – Keyward args.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.LayerBase.FPropDefaultTheta">
<code class="descname">FPropDefaultTheta</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase.FPropDefaultTheta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.FPropDefaultTheta" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls FProp.</p>
</dd></dl>

<dl class="classmethod">
<dt id="lingvo.core.base_layer.LayerBase.FPropMeta">
<em class="property">classmethod </em><code class="descname">FPropMeta</code><span class="sig-paren">(</span><em>params</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase.FPropMeta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.FPropMeta" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns metadata about the FProp computation for this layer.</p>
<dl class="docutils">
<dt>!!!Experimental features!!! Don’t use or depend on it without consulting</dt>
<dd>lingvo authors.</dd>
<dt>E.g.,</dt>
<dd>p = SomeComplexLayer.Params()
meta = p.cls.FPropMeta(p, tf.TensorShape([128, 20, 50, 32]))</dd>
</dl>
<p>meta.flops gives an estimate count of floating point operations done by
one FProp given an input tensor of shape [128, 20, 50, 32].
meta.out_shapes is a tuple of tensor shapes, which tells you what shape
of tensors this layer will return.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>params</strong> – The param of a layer of this layer type. <a href="#id1"><span class="problematic" id="id2">*</span></a>args, <a href="#id3"><span class="problematic" id="id4">**</span></a>kwargs:
Corresponds to <a href="#id5"><span class="problematic" id="id6">*</span></a>args and <a href="#id7"><span class="problematic" id="id8">**</span></a>kwargs of FProp methods.  Each value of <a href="#id9"><span class="problematic" id="id10">*</span></a>args
and <a href="#id11"><span class="problematic" id="id12">**</span></a>kwargs is a fully specified TensorShape representing the concrete
shape of the tensor being forward propagated.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><dl class="docutils">
<dt>flops - The estimated number of floating point operations incurred by</dt>
<dd>this fprop.</dd>
<dt>out_shapes - A tuple of tf.TensorShape. I.e., out_shapes[i] represents</dt>
<dd>the shape of the i-th returned tensor of the fprop.</dd>
</dl>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">A NestedMap of fields</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.LayerBase.GetAccumulatorValues">
<code class="descname">GetAccumulatorValues</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase.GetAccumulatorValues"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.GetAccumulatorValues" title="Permalink to this definition">¶</a></dt>
<dd><p>Recursively gets values of all accumulators.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Tensor for each registered accumulator.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">Nested map of name</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.core.base_layer.LayerBase.INFERENCE_DRIVER_NAME">
<code class="descname">INFERENCE_DRIVER_NAME</code><em class="property"> = None</em><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.INFERENCE_DRIVER_NAME" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="lingvo.core.base_layer.LayerBase.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.LayerBase.PostTrainingStepUpdate">
<code class="descname">PostTrainingStepUpdate</code><span class="sig-paren">(</span><em>global_step</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase.PostTrainingStepUpdate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.PostTrainingStepUpdate" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a TF node which will be invoked at each training step.</p>
<p>Subclasses of Layers can implement this method. The method should return a
TF node which will be invoked during training after gradients are applied.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>global_step</strong> – the global step.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.LayerBase.RegisterAccumulator">
<code class="descname">RegisterAccumulator</code><span class="sig-paren">(</span><em>name</em>, <em>acc</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase.RegisterAccumulator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.RegisterAccumulator" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers an accumulator for this layer.</p>
<p>An accumulator is used to propagate some state to a future point,
where it is acted on (typically as part of PostTrainingStepUpdate). This
mechanism allows for aribitrarily nested parts of a model to export state
back to the global scope. Accumulators must be specially handled
when crossing into Defun or recurrent scopes. By abstracting the mechanism,
it allows all such state to be handled uniformly and generically.</p>
<dl class="docutils">
<dt>Example (typically from __init__):</dt>
<dd><dl class="first docutils">
<dt>class MyAccumulator(base_layer.Accumulator):</dt>
<dd><dl class="first last docutils">
<dt>def DefaultValue(self):</dt>
<dd># [count, min, max]
return tf.convert_to_tensor([0.0, 0.0, 0.0])</dd>
<dt>def Update(self, state1):</dt>
<dd><p class="first">state0 = self.GetValue()
self.SetValue(tf.stack([</p>
<blockquote class="last">
<div>state0[0] + state1[0],
tf.minimum(state0[1], state1[1]),
tf.maximum(state0[2], state1[2])]))</div></blockquote>
</dd>
</dl>
</dd>
</dl>
<p class="last">self.RegisterAccumulator(‘mytracker’, acc)</p>
</dd>
<dt>Later, access the current value and update it:</dt>
<dd>acc = self.accumulators.mytracker
acc.Update(tf.convert_to_tensor([1.0, batch_min, batch_max]))</dd>
<dt>Then, typically in PostTrainingUpdateStep:</dt>
<dd>acc = self.accumulator.mytracker.GetValue()
acc_value = acc.GetValue()
# Do something with the value.
acc.Reset()</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> – The accumulator name. Shares a namespace with children, vars and
extra theta.</li>
<li><strong>acc</strong> – An Accumulator instance.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.base_layer.LayerBase.SetAccumulatorValues">
<code class="descname">SetAccumulatorValues</code><span class="sig-paren">(</span><em>new_values_nmap</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#LayerBase.SetAccumulatorValues"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.SetAccumulatorValues" title="Permalink to this definition">¶</a></dt>
<dd><p>Recursively sets the values of all accumulators from a map.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>new_values_nmap</strong> – NestedMap of accumulator name:Tensor.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.core.base_layer.LayerBase.accumulators">
<code class="descname">accumulators</code><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.accumulators" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a NestedMap of Accumulator instances for this and children.</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.core.base_layer.LayerBase.children">
<code class="descname">children</code><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.children" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns children layers of this layer in a NestedMap.</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.core.base_layer.LayerBase.fns">
<code class="descname">fns</code><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.fns" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a read-only view of layer local functions.</p>
<p>Functions can be accessed by index ([‘name’]) or attribute notation
(fns.foo).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Read-only attribute accessible dict view of the layer’s function library.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.core.base_layer.LayerBase.params">
<code class="descname">params</code><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the params upon which this layer is built.</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.core.base_layer.LayerBase.theta">
<code class="descname">theta</code><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.theta" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns theta of this layer and its children in a NestedMap.</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.core.base_layer.LayerBase.vars">
<code class="descname">vars</code><a class="headerlink" href="#lingvo.core.base_layer.LayerBase.vars" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns variables of this layer and its children in a NestedMap.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="lingvo.core.base_layer.RecursiveFindLayerParams">
<code class="descclassname">lingvo.core.base_layer.</code><code class="descname">RecursiveFindLayerParams</code><span class="sig-paren">(</span><em>params</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#RecursiveFindLayerParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.RecursiveFindLayerParams" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all params that define a layer.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.base_layer.initializer">
<code class="descclassname">lingvo.core.base_layer.</code><code class="descname">initializer</code><span class="sig-paren">(</span><em>func</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_layer.html#initializer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_layer.initializer" title="Permalink to this definition">¶</a></dt>
<dd><p>A decorator for layer’s __init__.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>func</strong> – The __init__ method of LayerBase’s subclasses.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A decorator wrapper for layer’s initializer.</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lingvo.core.base_layer_test.html" class="btn btn-neutral float-right" title="lingvo.core.base_layer_test module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lingvo.core.base_input_generator.html" class="btn btn-neutral" title="lingvo.core.base_input_generator module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>